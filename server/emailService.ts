/**
 * ุฎุฏูุฉ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุจุงุณุชุฎุฏุงู MailerSend
 * ุชูุฏู ูุธุงุฆู ูุฅุฑุณุงู ุฑุณุงุฆู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูุซู ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ ูุงูุฅุดุนุงุฑุงุช
 */

import { MailerSend, EmailParams, Sender, Recipient } from "mailersend";

if (!process.env.MAILERSEND_API_KEY) {
  console.error("ุฎุทุฃ: ูู ูุชู ุชูููุฑ ููุชุงุญ API ูู MailerSend");
  throw new Error("MAILERSEND_API_KEY environment variable is not set");
}

// ุฅูุดุงุก ูุซูู ุฌุฏูุฏ ูู MailerSend ุจุงุณุชุฎุฏุงู ููุชุงุญ API
const mailerSend = new MailerSend({
  apiKey: process.env.MAILERSEND_API_KEY,
});

// ูุนูููุงุช ุงููุฑุณู ุงูุงูุชุฑุงุถูุฉ
const defaultSender = new Sender("support@techlink.sa", "ููุตุฉ ุชููููู");

/**
 * ุฅุฑุณุงู ุจุฑูุฏ ุฅููุชุฑููู ูุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ
 * @param email ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูููุณุชูู
 * @param name ุงุณู ุงููุณุชูู
 * @param resetToken ุฑูุฒ ุฅุนุงุฏุฉ ุงูุชุนููู
 * @param resetLink ุฑุงุจุท ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ
 * @returns ูุนุฏ ูุญู ุนูุฏ ูุฌุงุญ ุงูุฅุฑุณุงู ุฃู ูุฑูุถ ุนูุฏ ุงููุดู
 */
export async function sendPasswordResetEmail(
  email: string,
  name: string,
  resetToken: string,
  resetLink: string
): Promise<boolean> {
  try {
    const recipients = [new Recipient(email, name)];

    // ุจูุงุก ูุงูุจ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
    const emailParams = new EmailParams()
      .setFrom(defaultSender)
      .setTo(recipients)
      .setReplyTo(defaultSender)
      .setSubject("ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ ูููุตุฉ ุชููููู")
      .setHtml(`
        <div dir="rtl" style="font-family: Arial, sans-serif; line-height: 1.6; color: #333;">
          <h2 style="color: #10B981;">ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ</h2>
          <p>ูุฑุญุจุงู ${name}ุ</p>
          <p>ููุฏ ุชููููุง ุทูุจุงู ูุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ ุงูุฎุงุตุฉ ุจู ูู ููุตุฉ ุชููููู.</p>
          <p>ุฅุฐุง ูู ุชุทูุจ ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑุ ููููู ุชุฌุงูู ูุฐุง ุงูุจุฑูุฏ ุงูุฅููุชุฑููู.</p>
          <p>ูุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ ุงูุฎุงุตุฉ ุจูุ ูุฑุฌู ุงูุถุบุท ุนูู ุงูุฑุงุจุท ุฃุฏูุงู:</p>
          <p style="margin: 20px 0;">
            <a 
              href="${resetLink}" 
              style="background-color: #10B981; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px; display: inline-block;"
            >
              ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ
            </a>
          </p>
          <p>ุฃู ููููู ูุณุฎ ููุตู ุงูุฑุงุจุท ุงูุชุงูู ูู ูุชุตูุญู:</p>
          <p style="margin: 20px 0;">
            <a href="${resetLink}" style="color: #10B981;">${resetLink}</a>
          </p>
          <p>ูุฑุฌู ููุงุญุธุฉ ุฃู ุฑุงุจุท ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ ุตุงูุญ ููุฏุฉ 24 ุณุงุนุฉ ููุท.</p>
          <p>ุฅุฐุง ููุช ุจุญุงุฌุฉ ุฅูู ูุณุงุนุฏุฉ ุฅุถุงููุฉุ ูุฑุฌู ุงูุงุชุตุงู ุจูุฑูู ุงูุฏุนู ุงูุฎุงุต ุจูุง.</p>
          <p style="margin-top: 30px;">ูุน ุฃุทูุจ ุงูุชุญูุงุชุ<br>ูุฑูู ููุตุฉ ุชููููู</p>
        </div>
      `)
      .setText(`
        ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ
        
        ูุฑุญุจุงู ${name}ุ
        
        ููุฏ ุชููููุง ุทูุจุงู ูุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ ุงูุฎุงุตุฉ ุจู ูู ููุตุฉ ุชููููู.
        
        ุฅุฐุง ูู ุชุทูุจ ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑุ ููููู ุชุฌุงูู ูุฐุง ุงูุจุฑูุฏ ุงูุฅููุชุฑููู.
        
        ูุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ ุงูุฎุงุตุฉ ุจูุ ูุฑุฌู ุฒูุงุฑุฉ ุงูุฑุงุจุท ุงูุชุงูู:
        ${resetLink}
        
        ูุฑุฌู ููุงุญุธุฉ ุฃู ุฑุงุจุท ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ ุตุงูุญ ููุฏุฉ 24 ุณุงุนุฉ ููุท.
        
        ุฅุฐุง ููุช ุจุญุงุฌุฉ ุฅูู ูุณุงุนุฏุฉ ุฅุถุงููุฉุ ูุฑุฌู ุงูุงุชุตุงู ุจูุฑูู ุงูุฏุนู ุงูุฎุงุต ุจูุง.
        
        ูุน ุฃุทูุจ ุงูุชุญูุงุชุ
        ูุฑูู ููุตุฉ ุชููููู
      `);

    // ุฅุฑุณุงู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
    const response = await mailerSend.email.send(emailParams);
    console.log("ุชู ุฅุฑุณุงู ุจุฑูุฏ ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ ุจูุฌุงุญ ุฅูู:", email);
    console.log("ุฑูุฒ ุฅุนุงุฏุฉ ุงูุชุนููู:", resetToken);
    return true;
  } catch (error) {
    console.error("ุฎุทุฃ ูู ุฅุฑุณุงู ุจุฑูุฏ ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ:", error);
    return false;
  }
}

/**
 * ุฅุฑุณุงู ุจุฑูุฏ ุฅููุชุฑููู ููุชุฑุญูุจ ุจุงููุณุชุฎุฏู ุงูุฌุฏูุฏ
 * @param email ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูููุณุชูู
 * @param name ุงุณู ุงููุณุชูู
 * @returns ูุนุฏ ูุญู ุนูุฏ ูุฌุงุญ ุงูุฅุฑุณุงู ุฃู ูุฑูุถ ุนูุฏ ุงููุดู
 */
export async function sendWelcomeEmail(
  email: string,
  name: string
): Promise<boolean> {
  try {
    const recipients = [new Recipient(email, name)];

    // ุจูุงุก ูุงูุจ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
    const emailParams = new EmailParams()
      .setFrom(defaultSender)
      .setTo(recipients)
      .setReplyTo(defaultSender)
      .setSubject("ูุฑุญุจุงู ุจู ูู ููุตุฉ ุชููููู")
      .setHtml(`
        <div dir="rtl" style="font-family: Arial, sans-serif; line-height: 1.6; color: #333;">
          <h2 style="color: #10B981;">ูุฑุญุจุงู ุจู ูู ููุตุฉ ุชููููู</h2>
          <p>ูุฑุญุจุงู ${name}ุ</p>
          <p>ูุดูุฑู ุนูู ุงูุชุณุฌูู ูู ููุตุฉ ุชููููู! ูุญู ุณุนุฏุงุก ุจุงูุถูุงูู ุฅูููุง.</p>
          <p>ููุตุฉ ุชููููู ูู ุงูููุงู ุงููุซุงูู ููุฑุจุท ุจูู ุฑูุงุฏ ุงูุฃุนูุงู ูุดุฑูุงุช ุงูุจุฑูุฌุฉ ูุชุญููู ุงููุดุงุฑูุน ุงูุชูููุฉ ุจูุฌุงุญ.</p>
          <p>ููููู ุงูุขู:</p>
          <ul style="list-style-type: none; padding-right: 20px;">
            <li>โ ุงุณุชูุดุงู ุงููุดุงุฑูุน ุงููุชุงุญุฉ</li>
            <li>โ ุงูุชูุงุตู ูุน ุฃูุถู ุงููุทูุฑูู</li>
            <li>โ ุฅุฏุงุฑุฉ ูุดุงุฑูุนู ุจููุงุกุฉ</li>
          </ul>
          <p style="margin: 20px 0;">
            <a 
              href="https://techlink.sa/dashboard" 
              style="background-color: #10B981; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px; display: inline-block;"
            >
              ุงูุฐูุงุจ ุฅูู ููุญุฉ ุงูุชุญูู
            </a>
          </p>
          <p>ุฅุฐุง ูุงู ูุฏูู ุฃู ุฃุณุฆูุฉ ุฃู ุงุณุชูุณุงุฑุงุชุ ูุง ุชุชุฑุฏุฏ ูู ุงูุชูุงุตู ูุนูุง.</p>
          <p style="margin-top: 30px;">ูุน ุฃุทูุจ ุงูุชุญูุงุชุ<br>ูุฑูู ููุตุฉ ุชููููู</p>
        </div>
      `)
      .setText(`
        ูุฑุญุจุงู ุจู ูู ููุตุฉ ุชููููู
        
        ูุฑุญุจุงู ${name}ุ
        
        ูุดูุฑู ุนูู ุงูุชุณุฌูู ูู ููุตุฉ ุชููููู! ูุญู ุณุนุฏุงุก ุจุงูุถูุงูู ุฅูููุง.
        
        ููุตุฉ ุชููููู ูู ุงูููุงู ุงููุซุงูู ููุฑุจุท ุจูู ุฑูุงุฏ ุงูุฃุนูุงู ูุดุฑูุงุช ุงูุจุฑูุฌุฉ ูุชุญููู ุงููุดุงุฑูุน ุงูุชูููุฉ ุจูุฌุงุญ.
        
        ููููู ุงูุขู:
        - ุงุณุชูุดุงู ุงููุดุงุฑูุน ุงููุชุงุญุฉ
        - ุงูุชูุงุตู ูุน ุฃูุถู ุงููุทูุฑูู
        - ุฅุฏุงุฑุฉ ูุดุงุฑูุนู ุจููุงุกุฉ
        
        ููุฐูุงุจ ุฅูู ููุญุฉ ุงูุชุญููุ ูุฑุฌู ุฒูุงุฑุฉ ุงูุฑุงุจุท ุงูุชุงูู:
        https://techlink.sa/dashboard
        
        ุฅุฐุง ูุงู ูุฏูู ุฃู ุฃุณุฆูุฉ ุฃู ุงุณุชูุณุงุฑุงุชุ ูุง ุชุชุฑุฏุฏ ูู ุงูุชูุงุตู ูุนูุง.
        
        ูุน ุฃุทูุจ ุงูุชุญูุงุชุ
        ูุฑูู ููุตุฉ ุชููููู
      `);

    // ุฅุฑุณุงู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
    const response = await mailerSend.email.send(emailParams);
    console.log("ุชู ุฅุฑุณุงู ุจุฑูุฏ ุงูุชุฑุญูุจ ุจูุฌุงุญ ุฅูู:", email);
    return true;
  } catch (error) {
    console.error("ุฎุทุฃ ูู ุฅุฑุณุงู ุจุฑูุฏ ุงูุชุฑุญูุจ:", error);
    return false;
  }
}

/**
 * ุฅุฑุณุงู ุฅุดุนุงุฑ ุจุนุฑุถ ุฌุฏูุฏ ุนูู ูุดุฑูุน
 * @param email ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูููุณุชูู
 * @param name ุงุณู ุงููุณุชูู
 * @param projectName ุงุณู ุงููุดุฑูุน
 * @param companyName ุงุณู ุงูุดุฑูุฉ ุงูุชู ูุฏูุช ุงูุนุฑุถ
 * @param offerAmount ูููุฉ ุงูุนุฑุถ
 * @param projectLink ุฑุงุจุท ุตูุญุฉ ุงููุดุฑูุน
 * @returns ูุนุฏ ูุญู ุนูุฏ ูุฌุงุญ ุงูุฅุฑุณุงู ุฃู ูุฑูุถ ุนูุฏ ุงููุดู
 */
export async function sendNewOfferNotification(
  email: string,
  name: string,
  projectName: string,
  companyName: string,
  offerAmount: number,
  projectLink: string
): Promise<boolean> {
  try {
    const recipients = [new Recipient(email, name)];

    // ุจูุงุก ูุงูุจ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
    const emailParams = new EmailParams()
      .setFrom(defaultSender)
      .setTo(recipients)
      .setReplyTo(defaultSender)
      .setSubject(`ุนุฑุถ ุฌุฏูุฏ ุนูู ูุดุฑูุนู: ${projectName}`)
      .setHtml(`
        <div dir="rtl" style="font-family: Arial, sans-serif; line-height: 1.6; color: #333;">
          <h2 style="color: #10B981;">ุนุฑุถ ุฌุฏูุฏ ุนูู ูุดุฑูุนู</h2>
          <p>ูุฑุญุจุงู ${name}ุ</p>
          <p>ุชูุงูููุง! ููุฏ ุชูููุช ุนุฑุถุงู ุฌุฏูุฏุงู ุนูู ูุดุฑูุนู <strong>${projectName}</strong>.</p>
          <p><strong>ุชูุงุตูู ุงูุนุฑุถ:</strong></p>
          <ul style="list-style-type: none; padding-right: 20px;">
            <li>๐ข <strong>ุงูุดุฑูุฉ:</strong> ${companyName}</li>
            <li>๐ฐ <strong>ูููุฉ ุงูุนุฑุถ:</strong> ${offerAmount} ุฑูุงู ุณุนูุฏู</li>
          </ul>
          <p>ููููู ุงูุงุทูุงุน ุนูู ุชูุงุตูู ุงูุนุฑุถ ููุฑุงุฌุนุชู ูู ุฎูุงู ุงูุฑุงุจุท ุฃุฏูุงู:</p>
          <p style="margin: 20px 0;">
            <a 
              href="${projectLink}" 
              style="background-color: #10B981; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px; display: inline-block;"
            >
              ุนุฑุถ ุงูุชูุงุตูู
            </a>
          </p>
          <p>ูุฑุฌู ูุฑุงุฌุนุฉ ุงูุนุฑุถ ูู ุฃูุฑุจ ููุช ูููู.</p>
          <p style="margin-top: 30px;">ูุน ุฃุทูุจ ุงูุชุญูุงุชุ<br>ูุฑูู ููุตุฉ ุชููููู</p>
        </div>
      `)
      .setText(`
        ุนุฑุถ ุฌุฏูุฏ ุนูู ูุดุฑูุนู
        
        ูุฑุญุจุงู ${name}ุ
        
        ุชูุงูููุง! ููุฏ ุชูููุช ุนุฑุถุงู ุฌุฏูุฏุงู ุนูู ูุดุฑูุนู "${projectName}".
        
        ุชูุงุตูู ุงูุนุฑุถ:
        - ุงูุดุฑูุฉ: ${companyName}
        - ูููุฉ ุงูุนุฑุถ: ${offerAmount} ุฑูุงู ุณุนูุฏู
        
        ููููู ุงูุงุทูุงุน ุนูู ุชูุงุตูู ุงูุนุฑุถ ููุฑุงุฌุนุชู ูู ุฎูุงู ุงูุฑุงุจุท ุฃุฏูุงู:
        ${projectLink}
        
        ูุฑุฌู ูุฑุงุฌุนุฉ ุงูุนุฑุถ ูู ุฃูุฑุจ ููุช ูููู.
        
        ูุน ุฃุทูุจ ุงูุชุญูุงุชุ
        ูุฑูู ููุตุฉ ุชููููู
      `);

    // ุฅุฑุณุงู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
    const response = await mailerSend.email.send(emailParams);
    console.log("ุชู ุฅุฑุณุงู ุฅุดุนุงุฑ ุงูุนุฑุถ ุงูุฌุฏูุฏ ุจูุฌุงุญ ุฅูู:", email);
    return true;
  } catch (error) {
    console.error("ุฎุทุฃ ูู ุฅุฑุณุงู ุฅุดุนุงุฑ ุงูุนุฑุถ ุงูุฌุฏูุฏ:", error);
    return false;
  }
}