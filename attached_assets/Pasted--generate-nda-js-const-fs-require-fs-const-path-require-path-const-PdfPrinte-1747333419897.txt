// generate-nda.js
const fs       = require('fs');
const path     = require('path');
const PdfPrinter = require('pdfmake');

// 1. تسجيل الخطّ (تأكّد أن Cairo-Regular.ttf في مجلد fonts/)
const fonts = {
  Cairo: {
    normal:      path.join(__dirname, 'fonts', 'Cairo-Regular.ttf'),
    bold:        path.join(__dirname, 'fonts', 'Cairo-Regular.ttf'),
    italics:     path.join(__dirname, 'fonts', 'Cairo-Regular.ttf'),
    bolditalics: path.join(__dirname, 'fonts', 'Cairo-Regular.ttf')
  }
};

const printer = new PdfPrinter(fonts);

// 2. نصوص الاتفاقية (كل فقرة عنصر منفصل)
const content = [
  { text: 'اتفاقية عدم الإفصاح', style: 'header' },
  {
    text: `بموجب هذه الاتفاقية، يلتزم الطرف الثاني بالحفاظ على سرية جميع المعلومات المتعلقة بالمشروع،
وعدم مشاركتها مع أي طرف ثالث دون إذن كتابي مسبق من الطرف الأول.`,
    style: 'paragraph'
  },
  {
    text: `تسري هذه الاتفاقية اعتباراً من تاريخ التوقيع الإلكتروني عليها، وتشمل جميع المراسلات
والمستندات والمعلومات التي يتم تبادلها بين الطرفين لغرض تنفيذ المشروع.`,
    style: 'paragraph'
  },
  {
    text: `في حال الإخلال بأي من بنود هذه الاتفاقية، يحق للطرف المتضرر اتخاذ كافة الإجراءات القانونية
اللازمة لحماية مصالحه وحقوقه.`,
    style: 'paragraph'
  },
  { text: 'الطرف الأول: منصة لينكتك (https://linktech.app)', style: 'paragraph' },
  { text: 'الطرف الثاني: .........................................', style: 'paragraph' },
  { text: 'التوقيع: _____________    2025-05-15', style: 'paragraph', margin: [0, 20, 0, 0] }
];

// 3. إعداد تعريف الوثيقة مع تمكين RTL
const docDefinition = {
  // تمكين Right-to-Left افتراضيًا
  rtl: true,

  // المسافات حول الصفحة
  pageMargins: [40, 60, 40, 60],

  // الخط الافتراضي والمحاذاة
  defaultStyle: {
    font: 'Cairo',
    alignment: 'right',
    lineHeight: 1.3
  },

  // أنماط جاهزة للعناوين والفقرات
  styles: {
    header:    { fontSize: 20, bold: true, margin: [0, 0, 0, 10] },
    paragraph: { fontSize: 11, margin: [0, 0, 0, 6] }
  },

  // المحتوى
  content
};

// 4. إنشاء وتصدير الـ PDF
const pdfDoc = printer.createPdfKitDocument(docDefinition);
pdfDoc.pipe(fs.createWriteStream('NDA_Linktek.pdf'));
pdfDoc.end();

console.log('✅ تم إنشاء NDA_Linktek.pdf بنجاح');